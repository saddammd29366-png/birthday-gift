<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Choose Your Gift ğŸ</title>
  <link rel="stylesheet" href="style.css">

  <!-- Preload images -->
  <link rel="preload" as="image" href="cover1.png">
  <link rel="preload" as="image" href="cover2.png">
  <link rel="preload" as="image" href="cover3.png">
  <link rel="preload" as="image" href="cover4.png">
  <link rel="preload" as="image" href="gift1.jpg">
  <link rel="preload" as="image" href="gift2.jpg">
  <link rel="preload" as="image" href="gift3.jpg">
  <link rel="preload" as="image" href="gift4.jpg">
</head>

<body>

<!-- Background Music -->
<audio id="bgMusic" loop preload="auto" playsinline>
  <source src="bg-music.mp3" type="audio/mpeg">
</audio>

<button id="muteBtn" onclick="toggleMusic()" style="display:none;">
  ğŸ”‡ Mute Music
</button>

<h1>ğŸ Choose one giftâ€¦ one is very special ğŸ’–</h1>

<div id="wishMessage">
  <p>
    Here are some mystery gifts ğŸ<br>
    One of them is very specialâ€¦ choose carefully ğŸ’–
  </p>
</div>

<!-- Gift options -->
<div id="giftOptions">

  <div class="giftCard" onclick="chooseGift(0)">
    <img class="giftImage" src="gift1.jpg" alt="Gift 1" loading="eager">
    <img class="cover" src="cover1.png" alt="Mystery Gift" loading="eager">
  </div>

  <div class="giftCard" onclick="chooseGift(1)">
    <img class="giftImage" src="gift2.jpg" alt="Gift 2" loading="eager">
    <img class="cover" src="cover2.png" alt="Mystery Gift" loading="eager">
  </div>

  <div class="giftCard" onclick="chooseGift(2)">
    <img class="giftImage" src="gift3.jpg" alt="Gift 3" loading="eager">
    <img class="cover" src="cover3.png" alt="Mystery Gift" loading="eager">
  </div>

  <div class="giftCard" onclick="chooseGift(3)">
    <img class="giftImage" src="gift4.jpg" alt="Gift 4" loading="eager">
    <img class="cover" src="cover4.png" alt="Mystery Gift" loading="eager">
  </div>

</div>

<script>
/* =========================
   GOOGLE SHEET LOGGING
   ========================= */
const LOG_URL = "https://script.google.com/macros/s/AKfycbwZmpI07ZG70hkS6Xg497oD2DJYPPzAAfZUXpLJl261dk9IUn-5GQx2NIW_HugC70oFaA/exec";

/* =========================
   MUSIC
   ========================= */
const music = document.getElementById("bgMusic");
const muteBtn = document.getElementById("muteBtn");

if (sessionStorage.getItem("music") === "on") {
  const startOnTap = () => {
    music.volume = 0.6;
    music.play().then(() => {
      muteBtn.style.display = "block";
    }).catch(()=>{});
  };
  document.addEventListener("touchstart", startOnTap, { once:true });
  document.addEventListener("click", startOnTap, { once:true });
}

function toggleMusic(){
  if (music.paused) {
    music.play();
    muteBtn.innerText = "ğŸ”‡ Mute Music";
  } else {
    music.pause();
    muteBtn.innerText = "ğŸ”Š Play Music";
  }
}

/* =========================
   CONFETTI / SPARKLES
   ========================= */
function popConfetti(){
  const layer = document.createElement("div");
  layer.className = "fx-layer";
  document.body.appendChild(layer);

  const icons = ["ğŸ’–","âœ¨","ğŸ’","ğŸ‰","ğŸ’—","ğŸŒ¸"];
  const count = 28;

  for (let i = 0; i < count; i++) {
    const p = document.createElement("div");
    p.className = "fx-heart";
    p.textContent = icons[Math.floor(Math.random() * icons.length)];

    p.style.setProperty("--x", Math.random() * 100 + "vw");
    p.style.setProperty("--s", (16 + Math.random() * 18) + "px");
    p.style.setProperty("--d", (1200 + Math.random() * 900) + "ms");
    p.style.setProperty("--r", (Math.random() * 360 - 180) + "deg");

    p.style.marginLeft = (Math.random() * 40 - 20) + "px";
    layer.appendChild(p);
  }

  setTimeout(() => layer.remove(), 2600);
}

/* =========================
   GIFT LOGIC
   ========================= */
let giftChosen = false;

function chooseGift(index){
  if (giftChosen) return;

  const name = sessionStorage.getItem("username") || "Unknown";

  fetch(LOG_URL, {
    method: "POST",
    mode: "no-cors",
    body: JSON.stringify({
      name: name,
      gift: index + 1,
      ua: navigator.userAgent
    })
  });

  const cards = document.querySelectorAll(".giftCard");

  cards.forEach((card, i) => {
    if (i === index) {
      card.classList.add("revealed");

      card.style.position = "relative";
      card.style.width = "95vw";
      card.style.maxWidth = "520px";
      card.style.height = "55vh";
      card.style.margin = "0 auto";
      card.style.overflow = "hidden";
    } else {
      card.style.display = "none";
    }
  });

 function popConfetti(){
  const layer = document.createElement("div");
  layer.style.position = "fixed";
  layer.style.inset = "0";
  layer.style.pointerEvents = "none";
  layer.style.overflow = "hidden";
  layer.style.zIndex = "99999";
  document.body.appendChild(layer);

  const icons = ["ğŸ’–","âœ¨","ğŸ’","ğŸ‰","ğŸ’—","ğŸŒ¸"];
  const count = 28;

  for (let i = 0; i < count; i++) {
    const p = document.createElement("div");
    p.textContent = icons[Math.floor(Math.random() * icons.length)];
    p.style.position = "absolute";
    p.style.left = (Math.random() * 100) + "vw";
    p.style.top = "-10vh";
    p.style.fontSize = (16 + Math.random() * 18) + "px";
    p.style.opacity = "0";
    p.style.transition = "transform 0ms";
    layer.appendChild(p);

    const dur = 1200 + Math.random() * 900;
    const rot = (Math.random() * 360 - 180);

    p.animate([
      { opacity: 0, transform: `translateY(0) rotate(0deg) scale(0.9)` },
      { opacity: 1, offset: 0.1 },
      { opacity: 0, transform: `translateY(120vh) rotate(${rot}deg) scale(1.1)` }
    ], { duration: dur, easing: "ease-in", fill: "forwards" });
  }

  setTimeout(() => layer.remove(), 2600);
}

</script>

</body>
</html>

