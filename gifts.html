<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Choose Your Gift ğŸ</title>
  <link rel="stylesheet" href="style.css">

  <!-- Preload images -->
  <link rel="preload" as="image" href="cover1.png">
  <link rel="preload" as="image" href="cover2.png">
  <link rel="preload" as="image" href="cover3.png">
  <link rel="preload" as="image" href="cover4.png">
  <link rel="preload" as="image" href="gift1.jpg">
  <link rel="preload" as="image" href="gift2.jpg">
  <link rel="preload" as="image" href="gift3.jpg">
  <link rel="preload" as="image" href="gift4.jpg">
</head>

<body>

<!-- Background Music -->
<audio id="bgMusic" loop preload="auto" playsinline>
  <source src="bg-music.mp3" type="audio/mpeg">
</audio>

<button id="muteBtn" onclick="toggleMusic()" style="display:none;">
  ğŸ”‡ Mute Music
</button>

<!-- âœ… h1 must be inside body -->
<h1>ğŸ Choose one giftâ€¦ one is very special ğŸ’–</h1>

<div id="wishMessage">
  <p>
    Here are some mystery gifts ğŸ<br>
    One of them is very specialâ€¦ choose carefully ğŸ’–
  </p>
</div>

<!-- Gift options -->
<div id="giftOptions">

  <div class="giftCard" onclick="chooseGift(0)">
    <img class="giftImage" src="gift1.jpg" alt="Gift 1" loading="eager">
    <img class="cover" src="cover1.png" alt="Mystery Gift" loading="eager">
  </div>

  <div class="giftCard" onclick="chooseGift(1)">
    <img class="giftImage" src="gift2.jpg" alt="Gift 2" loading="eager">
    <img class="cover" src="cover2.png" alt="Mystery Gift" loading="eager">
  </div>

  <div class="giftCard" onclick="chooseGift(2)">
    <img class="giftImage" src="gift3.jpg" alt="Gift 3" loading="eager">
    <img class="cover" src="cover3.png" alt="Mystery Gift" loading="eager">
  </div>

  <div class="giftCard" onclick="chooseGift(3)">
    <img class="giftImage" src="gift4.jpg" alt="Gift 4" loading="eager">
    <img class="cover" src="cover4.png" alt="Mystery Gift" loading="eager">
  </div>

</div>

<script>
/* =========================
   GOOGLE SHEET LOGGING
   ========================= */
const LOG_URL = "https://script.google.com/macros/s/AKfycbwZmpI07ZG70hkS6Xg497oD2DJYPPzAAfZUXpLJl261dk9IUn-5GQx2NIW_HugC70oFaA/exec";

/* =========================
   USER NAME (âœ… safe)
   ========================= */
const userNameEl = document.getElementById("userName");
if (userNameEl) {
  userNameEl.innerText = sessionStorage.getItem("username") || "My Special One";
}

/* =========================
   MUSIC
   ========================= */
const music = document.getElementById("bgMusic");
const muteBtn = document.getElementById("muteBtn");

if (sessionStorage.getItem("music") === "on") {
  const startOnTap = () => {
    music.volume = 0.6;
    music.play().then(() => {
      muteBtn.style.display = "block";
    }).catch(()=>{});
  };
  document.addEventListener("touchstart", startOnTap, { once:true });
  document.addEventListener("click", startOnTap, { once:true });
}

function toggleMusic(){
  if (music.paused) {
    music.play();
    muteBtn.innerText = "ğŸ”‡ Mute Music";
  } else {
    music.pause();
    muteBtn.innerText = "ğŸ”Š Play Music";
  }
}

/* =========================
   GIFT LOGIC + SHEET LOG
   ========================= */
let giftChosen = false;

function chooseGift(index){
  if (giftChosen) return;

  const name = sessionStorage.getItem("username") || "Unknown";

  fetch(LOG_URL, {
    method: "POST",
    mode: "no-cors",
    body: JSON.stringify({
      name: name,
      gift: index + 1,
      ua: navigator.userAgent
    })
  });

  const cards = document.querySelectorAll(".giftCard");

  cards.forEach((card, i) => {
    const cover = card.querySelector(".cover");
    const giftImg = card.querySelector(".giftImage");

    if (i === index) {
      card.style.position = "relative";
      card.style.width = "95vw";
      card.style.maxWidth = "520px";
      card.style.height = "55vh";
      card.style.margin = "0 auto";
      card.style.overflow = "hidden";

      giftImg.style.display = "block";
      giftImg.style.position = "absolute";
      giftImg.style.top = "0";
      giftImg.style.left = "0";
      giftImg.style.width = "100%";
      giftImg.style.height = "100%";
      giftImg.style.objectFit = "cover";
      giftImg.style.opacity = "1";
      giftImg.style.visibility = "visible";
      giftImg.style.zIndex = "2";

      // âœ… force-hide cover (even if CSS uses !important)
      cover.style.setProperty("display", "none", "important");
    } else {
      card.style.display = "none";
    }
  });

  giftChosen = true;
}
</script>

</body>
</html>
